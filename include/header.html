<!DOCTYPE html>
<html lang="ja">

  <header id="header" role="banner">
    <div class="logo">
      <br><br><br><a href="index.html" title="KEI's TechLabo" rel="home">KEI's TechLabo<span>Train & Music</span></a><br><br><br>
    </div>
  </header>

<body>
  <nav id="mainNav">
    <div class="inner">
      <a class="menu" id="menu"><span>☰</span></a>
      <div class="panel">
        <ul>
          <li class="current-menu-item"><a href="index.html"><strong>トップページ</strong></a></li>
          <li>
            <a href="#"><strong>BveTrainsim</strong></a>
            <ul class="sub-menu">
              <li><a href="start.html">利用規約</a></li>
              <li><a href="data.html">データ</a></li>
              <li><a href="questions.html">よくある質問</a></li>
            </ul>
          </li>
          <li>
            <a href="#"><strong>BveEX</strong></a>
            <ul class="sub-menu">
              <li><a href="plugins.html">はじめに</a></li>
              <li><a href="plugin_AL.html">列車接近灯を作ろう</a></li>
              <li><a href="plugin_FD.html">FD表示灯を作ろう</a></li>
            </ul>
          </li>
          <li>
            <a href="#"><strong>耳コピ楽譜</strong></a>
            <ul class="sub-menu">
              <li><a href="sheets.html">はじめに</a></li>
              <li><a href="california.html">カリフォルニア・シャワーA ピアノ連弾</a></li>
              <li><a href="sakura.html">さくら住宅街 ピアノ連弾</a></li>
              <li><a href="bikego.html">じてんしゃでゴー！ ピアノ連弾</a></li>
            </ul>
          </li>
          <li><a href="contact.html"><strong>お問い合わせ</strong></a></li>
          <li><a href="introduce.html"><strong>管理人紹介</strong></a></li>
          <li><a href="links.html"><strong>リンク</strong></a></li>
        </ul>
      </div>
    </div>
  </nav>

 <script>
  document.addEventListener("DOMContentLoaded", function () {
  const menuBtn = document.querySelector("#mainNav .menu");
  const navPanel = document.querySelector("#mainNav .panel");

  if (!menuBtn || !navPanel) return;

  // メニュー開閉トグル
  menuBtn.addEventListener("click", () => {
    navPanel.classList.toggle("open");
  });

  // メニュー外クリックでメニュー閉じる
  document.addEventListener("click", (e) => {
    const isClickInside = navPanel.contains(e.target) || menuBtn.contains(e.target);
    if (!isClickInside) {
      navPanel.classList.remove("open");
      // サブメニューも全部閉じる
      navPanel.querySelectorAll("li.has-sub.open").forEach(li => li.classList.remove("open"));
    }
  });

  // サブメニュー持ちのliにクラス付与
  document.querySelectorAll("#mainNav .panel ul > li").forEach(li => {
    if (li.querySelector(".sub-menu")) {
      li.classList.add("has-sub");
    }
  });

  // サブメニュー開閉のセットアップ
  function setupSubMenuToggle() {
    // まず既存のリンクイベントリセットのためにクローンで置換
    document.querySelectorAll("#mainNav .panel ul > li.has-sub > a").forEach(link => {
      const newLink = link.cloneNode(true);
      link.parentNode.replaceChild(newLink, link);
    });

    if (window.matchMedia("(max-width: 768px)").matches) {
      // サブメニュー親リンクにクリックイベント付与
      document.querySelectorAll("#mainNav .panel ul > li.has-sub > a").forEach(link => {
        link.addEventListener("click", (e) => {
          e.preventDefault(); // ページ遷移させない

          const parentLi = link.parentElement;

          // 他のサブメニューは閉じる
          navPanel.querySelectorAll("li.has-sub.open").forEach(openLi => {
            if (openLi !== parentLi) openLi.classList.remove("open");
          });

          // 自分のサブメニュー開閉切替
          parentLi.classList.toggle("open");
        });
      });

      // サブメニューを持たないリンクはクリックでメニュー閉じる
      navPanel.querySelectorAll("a").forEach(link => {
        const parentLi = link.closest("li");
        if (!parentLi.classList.contains("has-sub")) {
          link.addEventListener("click", () => {
            navPanel.classList.remove("open");
            // ついでにサブメニューも閉じる
            navPanel.querySelectorAll("li.has-sub.open").forEach(li => li.classList.remove("open"));
          });
        }
      });
    } else {
      // PCサイズ以上はサブメニューはhoverで開く想定なのでopenクラスリセット
      navPanel.querySelectorAll("li.has-sub.open").forEach(li => li.classList.remove("open"));
    }
  }

  setupSubMenuToggle();

  // リサイズ時に再セットアップ
  window.addEventListener("resize", setupSubMenuToggle);
});
</script>

</body>
</html>
